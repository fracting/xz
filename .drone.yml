build:
  image: fracting/msys32
  shell: $$myshell
  commands:
    - if [ $$myshell = sh ]; then apt-get update -y; apt-get install build-essential; apt-get build-dep xz-utils; fi
    - if [ $$myshell = msys32 ]; then pacman -S --noconfirm --needed libiconv-devel gettext-devel; fi
    - if [ $$myshell = mingw32 ]; then pacman -S --noconfirm --needed mingw-w64-i686-pkg-config; fi
    - ./autogen.sh
    - ./configure
    - make
    - make check

notify:
  irc:
    prefix: build
    nick: xz
    channel: wine-zh
    server:
      host: chat.freenode.net
      port: 6667
  irc:
    prefix: build
    nick: xz
    channel: msys2
    server:
      host: irc.oftc.net
      port: 6667

matrix:
  myshell:
    - sh
    - msys32
    - mingw32
